---
title: "Introduction to fnirsr package"
author: "Eryk Walczak"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette will show how to load raw csv files produced by Hitachi ETG-4000 fNIRS. The rationale for writing this package was to allow conducting fNIRS data analysis in R.

## Loading a file (ETG-4000)

In its current development stage this package can only read raw csv files produced by Hitachi ETG-4000. Other systems produce file with a different structure and so far I did not need to use them. Eventually, I might expand this package to work with other file types.

File *Hitachi_ETG4000_24Ch_Total.csv* , which is used in this vignette and is attached to this package, comes from [NIRS-SPM](http://bispl.weebly.com/nirs-spm.html#/).

Top level information about the recording is held in a header. It has an irregular form so it is a bit tricky to parse.
This package version reads the section of the csv file before the data section and returns a vector with header info:

```{r, message=FALSE, warning=FALSE}
library(fnirsr)

file_path <- system.file("extdata", "Hitachi_ETG4000_24Ch_Total.csv", package = "fnirsr")
header <- load_ETG4000_header(file_path)

head(header)
```


Loading the signal from csv files can be accomplished using the basic `load_ETG4000_data()` function. It reads the data section of a csv file, changes the `Time` column to reflect time period from the beginning of the recording (instead of actual hour), and returns a data frame.

```{r}
df <- load_ETG4000_data(file_path)

str(df)
```


## Plotting a file (ETG-4000)

Once the csv file is loaded and a data frame is created, you can start plotting the signal.

Plotting function `plot_ETG4000()` comes with three arguments:
* `facets`
* `overlap`
* `channel`

The default choice is `facets` which will show all channels in separate facets. This should enable spotting outliers.

```{r, fig.width=10, fig.height=8}
plot_ETG4000(df)
```

Another option is plotting all channels overlapping each other:

```{r, fig.width=10, fig.height=8}
plot_ETG4000(df, type = "overlap")
```

Alternatively, if you want to plot a single channel of interest then use the `separate` argument and a channel number. This option uses time column as an x-axis (as opposed to the previous plots using samples).

```{r, fig.width=8, fig.height=6}
plot_ETG4000(df, type = "separate", channel = 1)
```

Next releases will include filtering, splitting, and averaging the continuous recordings.

## Loading a file (.nirs)

While working with fNIRS data you might come across other file formats. One of the most popular formats is *.nirs* which is used by [HOMER2](http://homer-fnirs.org/). This package's main goal is to help in analysing ETG-4000 data but I happened to write simple .nirs functions.

To load .nirs data use the following code:

```{r}
file_path_nirs <- system.file("extdata", "Simple_Probe.nirs", package = "fnirsr")
nirs_file <- load_nirs_data(file_path_nirs)
```

This will load a list with data and additional information. You can explore it in the following way:

```{r}
str(nirs_file)
```

The most interesting elements are `t` (time) and `d` (data):

```{r}
# matrix dimensions
dim(nirs_file$d)

# have a look at the data
head(nirs_file$d)
```

```{r, fig.width=10, fig.height=8}
plot_nirs(nirs_file)
```
